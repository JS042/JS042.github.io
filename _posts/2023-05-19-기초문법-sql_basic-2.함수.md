---
title: "[SQL 문법] 2. 함수"
excerpt: "0519 SQL 함수"

categories:
  - SQL 문법
tags:
  - []

permalink: /sql_basic/lesson2/

toc: true
toc_sticky: ture

date: 2023-05-19
last_modified_at: 2023-05-19
---

## 문자열 함수

`UPPER`: 대문자로 바꾸기  
`LOWER`: 소문자로 바꾸기  
`INITCAP`: 첫글자만 대문자, 나머지는 소문자로 바꾸기  

```sql
SELECT ENAME, UPPER(ENAME), LOWER(ENAME), INITCAP(ENAME) FROM EMP;
-- ENAME, ename, Ename
```

응용

```sql
SELECT * FROM EMP WHERE ENAME = 'SCOTT';
SELECT * FROM EMP WHERE UPPER(ENAME) = 'SCOTT';
SELECT * FROM EMP WHERE LOWER(ENAME) = 'scott';
SELECT * FROM EMP WHERE LOWER(ENAME) LIKE 's%';
```

`LENGTH`: 문자열 길이  
`LENGTHB`: 문자열 바이트: 한글은 2byte, 영어는 1byte

```sql
SELECT ENAME, LENGTH(ENAME) FROM EMP;
SELECT ENAME, LENGTH(ENAME) FROM EMP WHERE LENGTH(ENAME) >= 5;
SELECT ENAME, LENGTH(ENAME) FROM EMP WHERE LENGTH(ENAME) < 5;
```

```sql
-- DUAL: 관리자 계정 SYS 소유 테이블, 함수 기능이나 연산 등 테스트 목적으로 사용하는 가상 테이블
SELECT LENGTH('HELLO'), LENGTHB('HELLO') FROM DUAL; -- 5,5
SELECT LENGTH('안녕'), LENGTHB('안녕') FROM DUAL; -- 2,4
```

`SUBSTR`: 문자열 일부를 추출  

```sql
-- 첫번째 숫자: 시작 위치, 두 번째 숫자: 끝 위치 (생략하면 끝까지)
SELECT JOB, SUBSTR(JOB, 1, 2) FROM EMP;
SELECT JOB, SUBSTR(JOB, 3, 5) FROM EMP;
SELECT JOB, SUBSTR(JOB, 3) FROM EMP;
```

응용  
* 글자 수를 예측하기 어려울 때 LENGTH사용

```sql
-- LENGTH('CLERK'): 1 ~ 5 
SELECT JOB, LENGTH(JOB) FROM EMP;

-- LENGTH('CLERK'): -5 ~ -1
SELECT JOB, SUBSTR(JOB, -LENGTH(JOB)) FROM EMP; -- 처음부터 끝까지
SELECT JOB, SUBSTR(JOB, -LENGTH(JOB),2) FROM EMP;
SELECT JOB, SUBSTR(JOB, 1, 2) FROM EMP; -- 위와 동일

-- 뒤에서 찾고 싶을 때
SELECT JOB, SUBSTR(JOB, LENGTH(JOB)) FROM EMP; -- 뒤에서부터 1글자
SELECT JOB, SUBSTR(JOB, LENGTH(JOB)-1) FROM EMP; -- 뒤에서부터 2글자
```

`INSTR`: 특정 문자 위치

```sql
SELECT 
    INSTR('HELLO, ORACLE!', 'L'), -- L 글자가 처음 나타나는 위치
    INSTR('HELLO, ORACLE!', 'L',5), -- 5번째부터 L 글자가 처음 나타나는 위치
    INSTR('HELLO, ORACLE!', 'L',2,2) -- 2번째부터 L 글자가 두번째로 나타는 위치
FROM DUAL;
```

`REPLACE`: 다른 문자로 대체

```sql
SELECT '010-1234-5678',
    REPLACE('010-1234-5678', '-', ' '), -- 대시(-) 기호를 BLANK로 대체
    REPLACE('010-1234-5678', '-', '*'), -- 대시(-) 기호를 *로 대체
    REPLACE('010-1234-5678', '-') -- 대시(-) 기호를 ''로 대체 = 삭제
FROM DUAL;
```

`LPAD`, `RPAD`: 빈칸을 특정 문자로 채우기

```sql
SELECT 'Oracle',
    LPAD('Oracle', 10, '#'), -- 10자리, Oracle 글자를 오른쪽부터 넣고, 남은 자리를 왼쪽에서 # 채움
    RPAD('Oracle', 10, '*'), -- 10자리, Oracle 글자를 왼쪽부터 넣고, 남은 자리를 오른에서 * 채움
    LPAD('Oracle', 10), -- 10자리, Oracle 글자를 왼쪽부터 넣고, 남은 자리를 왼쪽에서 BLANK 채움
    RPAD('Oracle', 10) -- 10자리, Oracle 글자를 오른쪽부터 넣고, 남은 자리를 오른쪽에서 BLANK 채움
FROM DUAL;
```

`CONCAT`: 문자열 합치기

```sql
SELECT EMPNO, ENAME FROM EMP WHERE ENAME = 'SCOTT';
SELECT CONCAT(EMPNO, ENAME) FROM EMP WHERE ENAME = 'SCOTT';
SELECT CONCAT(':', ENAME), CONCAT(EMPNO, CONCAT(':',ENAME)) FROM EMP WHERE ENAME = 'SCOTT';

-- ||로 반환
SELECT EMPNO || ENAME FROM EMP WHERE ENAME = 'SCOTT';
SELECT ':' || ENAME, EMPNO || ':' || ENAME FROM EMP WHERE ENAME = 'SCOTT';
```

`TRIM`, `LTRIM`, `RTRIM`: 특정 문자를 지우는 함수

```sql
SELECT '['||' _ _ ORACLE _ _ '||']',
    '['||TRIM(' _ _ ORACLE _ _ ')||']',
    '['||TRIM(BOTH FROM ' _ _ ORACLE _ _ ')||']', -- TRIM
    '['||TRIM(LEADING FROM ' _ _ ORACLE _ _ ')||']', -- LTRIM
    '['||TRIM(TRAILING FROM ' _ _ ORACLE _ _ ')||']' -- RTRIM
FROM DUAL;

-- 함수 바꿔 그대로 재현
SELECT '[' || ' _ _ ORACLE _ _ ' || ']', -- [ _ _ ORACLE _ _ ]
    '[' || TRIM(' _ _ ORACLE _ _ ') || ']', -- [_ _ ORACLE _ _]
    '[' || LTRIM(' _ _ ORACLE _ _ ') || ']', -- [_ _ ORACLE _ _ ]
    '[' || RTRIM(' _ _ ORACLE _ _ ') || ']' -- [ _ _ ORACLE _ _]
FROM DUAL;
```

***

## 숫자 함수

`ROUND`: 반올림, 소수점 이하에서 표현할 자리수

```sql
SELECT 
    ROUND(1234.5678), -- 1235
    ROUND(1234.5678,0), -- 1235
    ROUND(1234.5678,1), -- 1234.6
    ROUND(1234.5678,2), -- 1234.57
    ROUND(1234.5678, -1) -- 1230
FROM DUAL;
```

`TRUNC`: 버리기

```sql
SELECT 
    TRUNC(1234.5678), -- 1234
    TRUNC(1234.5678,0), -- 1234
    TRUNC(1234.5678,1), -- 1234.5
    TRUNC(1234.5678,2), -- 1234.56
    TRUNC(1234.5678, -1) -- 1230
FROM DUAL;
```

`CEIL`, `FLOOR`: 정수 반환 함수

```sql
-- CEIL = 천장 = 높은 정수값 3 < 3.14 < 4
-- FLOOR = 바닥 = 낮은 정수값 3 < 3.14 < 4
SELECT 
    CEIL(3.14), -- 4
    FLOOR(3.14), -- 3
    CEIL(-3.14), -- -3
    FLOOR(-3.14) -- -4
FROM DUAL;
```

`MOD`: 나머지 함수

```sql
SELECT MOD(15,6), -- 3
    MOD(10,2), -- 0
    MOD(11,2) -- 1
FROM DUAL;
```

***

## 날짜 함수

`SYSDATE`: 현재 날짜를 알려주는 함수

```sql
SELECT SYSDATE FROM DUAL; -- 23/05/19
SELECT SYSDATE+1 FROM DUAL; -- 23/05/20
SELECT SYSDATE-1 FROM DUAL; -- 23/05/18
SELECT SYSDATE+100 FROM DUAL; -- 23/08/27
```

`ADD_MONTHS`: 특정 개월 후의 날짜
```sql
SELECT SYSDATE, ADD_MONTHS(SYSDATE,2) FROM DUAL; -- 23/7/19
SELECT SYSDATE, ADD_MONTHS(SYSDATE,120) FROM DUAL; -- 33/5/19

-- 입사 10주년
SELECT ENAME, HIREDATE, ADD_MONTHS(HIREDATE, 120) FROM EMP;
```

```sql
-- 입사 41주년 미만 = 입사일 > 현재날짜
SELECT ENAME, HIREDATE, ADD_MONTHS(HIREDATE, 492), SYSDATE 
FROM EMP
WHERE ADD_MONTHS(HIREDATE, 492) > SYSDATE;

-- 입사 41주년 초과 = 입사일 < 현재날짜
SELECT ENAME, HIREDATE, ADD_MONTHS(HIREDATE, 492), SYSDATE 
FROM EMP
WHERE ADD_MONTHS(HIREDATE, 492) < SYSDATE;
```

`MONTHS_BETWEEN`: 개월 수 차이

```sql
SELECT EMPNO, ENAME, HIREDATE, SYSDATE,
    MONTHS_BETWEEN(HIREDATE, SYSDATE), -- 과거날짜 - 현재날짜 = 음수
    MONTHS_BETWEEN(SYSDATE, HIREDATE), -- 현재날짜 - 과거날짜 = 양수
    TRUNC(MONTHS_BETWEEN(SYSDATE, HIREDATE)) -- 소수점 버림 = 정수 형태
FROM EMP;
```

`NEXT_DAY`: 돌아오는 요일의 날짜  
`LAST_DAY`: 해당 월의 마지막 날짜

```sql
SELECT 
    SYSDATE, -- 23/05/19
    NEXT_DAY(SYSDATE, '수요일'), -- 23/05/24
    LAST_DAY(SYSDATE) -- 23/05/31
FROM DUAL;
```

`ROUND`: 날짜 반올림  
* CC: 세기(100년)의 중앙값 51년 이상 반올림  
ex) 2016 => 2001    
* YYYY: 연도(1년)의 중앙값 7월 1일부터 반올림  
ex) 2016/07/01 => 2017/01/01  
* Q: 분기(3개월)의 중앙값 중앙에 있는 달의 16일부터 반올림  
ex) 2016/05/19 => 2016/07/01  
* DDD: 일(하루)의 중앙값 12시부터 반올림  
ex) 2016/05/19/14:18:00 => 2016/05/20  
* HH: 시간(60분)의 중앙값 31분부터 반올림  
ex) 2016/05/19/14:18:00 => 2016/05/19/14:00:00 

```sql
SELECT SYSDATE -- 23/05/19
    ROUND(SYSDATE, 'CC'), -- 01/01/01
    ROUND(SYSDATE, 'YYYY'), -- 23/01/01
    ROUND(SYSDATE, 'Q'), -- 23/07/01
    ROUND(SYSDATE, 'DDD'), -- 23/05/20
    ROUND(SYSDATE, 'HH') -- 23/05/19
FROM DUAL;
```

`TRUNC`: 날짜 버리기

```sql
SELECT SYSDATE -- 23/05/19
    TRUNC(SYSDATE, 'CC'), -- 01/01/01
    TRUNC(SYSDATE, 'YYYY'), -- 23/01/01
    TRUNC(SYSDATE, 'Q'), -- 23/04/01
    TRUNC(SYSDATE, 'DDD'), -- 23/05/19
    TRUNC(SYSDATE, 'HH') -- 23/05/19
FROM DUAL;
```
  
`TO_CHAR`: 문자형 변환

```sql
-- 날짜 포맷: 연월일은 '/'로 연결, 시분초는 ':'로 연결
SELECT SYSDATE, 
    TO_CHAR(SYSDATE, 'YYYY/MM/DD/ HH24:MI:SS') -- 2023/05/19/ 14:48:04
FROM DUAL;
```

- 월, 일
  
```sql
SELECT SYSDATE,
    TO_CHAR(SYSDATE, 'MM'), -- 숫자 월 (05)
    TO_CHAR(SYSDATE, 'MON'), -- 이름 월, 약자 (5월)
    TO_CHAR(SYSDATE, 'MONTH'), -- 이름 월, FULL NAME (5월)
    TO_CHAR(SYSDATE, 'DD'), -- 숫자 일 (19)
    TO_CHAR(SYSDATE, 'DY'), -- 이름 요일, 약자 (금)
    TO_CHAR(SYSDATE, 'DAY') -- 이름 요일, FULL NAME (금요일)
FROM DUAL;
```

 - 한글, 한문, 영어 비교  

```sql
SELECT SYSDATE,
    TO_CHAR(SYSDATE, 'MM'), -- (05)
    TO_CHAR(SYSDATE, 'MON', 'NLS_DATE_LANGUAGE = KOREAN') AS KOREAN_MONTH, -- (5월)
    TO_CHAR(SYSDATE, 'MON', 'NLS_DATE_LANGUAGE = JAPANESE') AS JAPAN_MONTH, -- (5月)
    TO_CHAR(SYSDATE, 'MON', 'NLS_DATE_LANGUAGE = ENGLISH') AS ENGLISH_MONTH, -- (MAY)
    TO_CHAR(SYSDATE, 'MONTH', 'NLS_DATE_LANGUAGE = KOREAN') AS KOREAN_MONTH, -- (5월)
    TO_CHAR(SYSDATE, 'MONTH', 'NLS_DATE_LANGUAGE = JAPANESE') AS JAPAN_MONTH, -- (5月)
    TO_CHAR(SYSDATE, 'MONTH', 'NLS_DATE_LANGUAGE = ENGLISH') AS ENGLISH_MONTH -- (MAY)
FROM DUAL;
```

```sql
SELECT SYSDATE,
    TO_CHAR(SYSDATE, 'DD'), -- (19)
    TO_CHAR(SYSDATE, 'DY', 'NLS_DATE_LANGUAGE = KOREAN') AS KOREAN_MONTH, -- (금)
    TO_CHAR(SYSDATE, 'DY', 'NLS_DATE_LANGUAGE = JAPANESE') AS JAPAN_MONTH, -- (金)
    TO_CHAR(SYSDATE, 'DY', 'NLS_DATE_LANGUAGE = ENGLISH') AS ENGLISH_MONTH, -- (FRI)
    TO_CHAR(SYSDATE, 'DAY', 'NLS_DATE_LANGUAGE = KOREAN') AS KOREAN_MONTH, -- (금요일)
    TO_CHAR(SYSDATE, 'DAY', 'NLS_DATE_LANGUAGE = JAPANESE') AS JAPAN_MONTH, -- (金曜日)
    TO_CHAR(SYSDATE, 'DAY', 'NLS_DATE_LANGUAGE = ENGLISH') AS ENGLISH_MONTH -- (FRIDAY)
FROM DUAL;
```

- 시분초  

```sql
SELECT SYSDATE, TO_CHAR(SYSDATE, 'HH24:MI:SS'), -- 24시간 (15:37:45)
                TO_CHAR(SYSDATE, 'HH12:MI:SS'), -- 12시간 (03:37:45)
                TO_CHAR(SYSDATE, 'HH12:MI:SS PM'), -- 12시간, 오전/오후 (03:37:45 오후)
                TO_CHAR(SYSDATE, 'HH:MI:SS PM') -- 위와 동일 (03:37:45 오후)
FROM DUAL;
```

- 숫자를 문자로 변환

```sql
SELECT SAL, -- (1600)
    TO_CHAR(SAL, '$999,999'), -- $ 천단위 ',' 구분 ($1,600)
    TO_CHAR(SAL, 'L999,999'), -- LOCAL 통화량 = 한국 원 & 천단위 ',' 구분 (￦1,600)
    TO_CHAR(SAL, '999,999.00'), -- 소수점 두 자리  & 숫자로만 표현 (1,600.00)
    TO_CHAR(SAL, '000,999,999.00'), -- 소수점 두 자리 & 9자리수 고정, 남은 자리 0으로 채움 & 천단위 ',' 구분 (000,001,600.00)
    TO_CHAR(SAL, '000999999.99'), -- 소수점 두 자리 & 9자리수 고정, 남은 자리 0으로 채움 (000001600.00)
    TO_CHAR(SAL, '999,999,00') -- 100 단위 ',' 구분 (16,00)
FROM EMP;
```

`TO_NUMBER`: 숫자형 변환

- 암시적 형 변환: 문자를 숫자로 자동으로 변환 = `TO_NUMBER` 사용하지 않음

```sql
SELECT 1300 - '1500', '1300' + 1500 FROM DUAL; -- (-200, 2800)

-- 1,000는 문자 -> 숫자 변환 불가 = 에러 발생
SELECT 1300 - '1,500', '1,300' + 1500 FROM DUAL;
```

- 명시적 형 변환: `TO_NUMBER` 사용해 숫자로 변환

```sql
SELECT 1300 - TO_NUMBER('1500'), TO_NUMBER('1300') + 1500 FROM DUAL; -- (-200, 2800)
SELECT TO_NUMBER('1,300', '999,999') - TO_NUMBER('1,500', '999,999') FROM DUAL;  -- (-200)
```

`TO_DATE`: 날짜형 변환

```sql
SELECT TO_DATE('2023-05-19', 'YYYY/MM/DD') FROM DUAL;
SELECT TO_DATE('20230519', 'YYYY/MM/DD') FROM DUAL;
SELECT TO_DATE('2023-05-19', 'YYYY-MM-DD') FROM DUAL;
SELECT TO_DATE('20230519', 'YYYY-MM-DD') FROM DUAL;
SELECT TO_DATE('2023/05/19', 'YYYY-MM-DD') FROM DUAL;
SELECT TO_DATE('2023/05/19', 'YYYY/MM/DD') FROM DUAL;
```

```sql
-- 사원 데이터에서 81년 7월 1일 이후에 입사한 사람
SELECT * FROM EMP
WHERE HIREDATE > TO_DATE('1981/07/01', 'YYYY/MM/DD');

-- 사원 데이터에서 81년 7월 1일 이전에 입사한 사람
SELECT * FROM EMP
WHERE HIREDATE < TO_DATE('1981/07/01', 'YYYY/MM/DD');
```

- RR: 1950 ~ 2049  
```sql
SELECT 
    TO_DATE('49/12/10', 'YY/MM/DD') AS Y1, -- 2049
	TO_DATE('49/12/10', 'RR/MM/DD') AS Y2, -- 2049
	TO_DATE('50/12/10', 'YY/MM/DD') AS Y3, -- 2050
	TO_DATE('50/12/10', 'RR/MM/DD') AS Y4, -- 1950
	TO_DATE('51/12/10', 'YY/MM/DD') AS Y5, -- 2051
	TO_DATE('51/12/10', 'RR/MM/DD') AS Y6  -- 1951
FROM DUAL;
```





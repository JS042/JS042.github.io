---
title: "[Python] 데이터 전처리(2) - 표준화"
excerpt: "0602 데이터 전처리(2) - 표준화"

categories:
  - 데이터 분석
tags:
  - []

permalink: /DA/lesson6-1/

toc: true
toc_sticky: ture

date: 2023-06-02
last_modified_at: 2023-06-05
---

## 단위 환산

```python
# 데이터 불러오기
import pandas as pd
df = pd.read_csv('/content/drive/MyDrive/hana1/PYTHON/data/auto-mpg.csv', header = None)

# 열 이름 지정
df.columns = ['mpg', 'cylinders', 'displacement', 'horsepower', 'weight', 
              'acceleration', 'model_year', 'origin', 'car_name']
```

```python
# 연비 mpg = mile per gallon
# kpl = kilometer per liter
# 1 mpg = 0.425 kpl
kpl = 0.425
df['kpl'] = df['mpg'] * kpl
df['kpl'] = df['kpl'].round(1)
df.head()
--------------------------------------

# mpg	cylinders	displacement	horsepower	weight	acceleration	model_year	origin	car_name	kpl
# 0	18.0	8	307.0	130.0	3504.0	12.0	70	1	chevrolet chevelle malibu	7.6
# 1	15.0	8	350.0	165.0	3693.0	11.5	70	1	buick skylark 320	6.4
# 2	18.0	8	318.0	150.0	3436.0	11.0	70	1	plymouth satellite	7.6
# 3	16.0	8	304.0	150.0	3433.0	12.0	70	1	amc rebel sst	6.8
# 4	17.0	8	302.0	140.0	3449.0	10.5	70	1	ford torino	7.2
```

## 자료형 변환

### 문자열 => 숫자

```python
df.dtypes
------------------------------
# mpg             float64
# cylinders         int64
# displacement    float64
# horsepower       object => 숫자지만 문자열
# weight          float64
# acceleration    float64
# model_year        int64
# origin            int64
# car_name         object
# kpl             float64
# dtype: object
```

- 문자열 확인하는 방법

```python
df['horsepower'].unique()
--------------------------------------------------------------------------------
# array(['130.0', '165.0', '150.0', '140.0', '198.0', '220.0', '215.0',
#        '225.0', '190.0', '170.0', '160.0', '95.00', '97.00', '85.00',
#        '88.00', '46.00', '87.00', '90.00', '113.0', '200.0', '210.0',
#        '193.0', '?', '100.0', '105.0', '175.0', '153.0', '180.0', '110.0',
#        '72.00', '86.00', '70.00', '76.00', '65.00', '69.00', '60.00',
#        '80.00', '54.00', '208.0', '155.0', '112.0', '92.00', '145.0',
#        '137.0', '158.0', '167.0', '94.00', '107.0', '230.0', '49.00',
#        '75.00', '91.00', '122.0', '67.00', '83.00', '78.00', '52.00',
#        '61.00', '93.00', '148.0', '129.0', '96.00', '71.00', '98.00',
#        '115.0', '53.00', '81.00', '79.00', '120.0', '152.0', '102.0',
#        '108.0', '68.00', '58.00', '149.0', '89.00', '63.00', '48.00',
#        '66.00', '139.0', '103.0', '125.0', '133.0', '138.0', '135.0',
#        '142.0', '77.00', '62.00', '132.0', '84.00', '64.00', '74.00',
#        '116.0', '82.00'], dtype=object)
```

- ? => NaN

```python
import numpy as np
df['horsepower'].replace('?',np.nan, inplace = True)
df['horsepower'].unique()
--------------------------------------------------------------------------------
# array(['130.0', '165.0', '150.0', '140.0', '198.0', '220.0', '215.0',
#        '225.0', '190.0', '170.0', '160.0', '95.00', '97.00', '85.00',
#        '88.00', '46.00', '87.00', '90.00', '113.0', '200.0', '210.0',
#        '193.0', 'nan', '100.0', '105.0', '175.0', '153.0', '180.0', '110.0',
#        '72.00', '86.00', '70.00', '76.00', '65.00', '69.00', '60.00',
#        '80.00', '54.00', '208.0', '155.0', '112.0', '92.00', '145.0',
#        '137.0', '158.0', '167.0', '94.00', '107.0', '230.0', '49.00',
#        '75.00', '91.00', '122.0', '67.00', '83.00', '78.00', '52.00',
#        '61.00', '93.00', '148.0', '129.0', '96.00', '71.00', '98.00',
#        '115.0', '53.00', '81.00', '79.00', '120.0', '152.0', '102.0',
#        '108.0', '68.00', '58.00', '149.0', '89.00', '63.00', '48.00',
#        '66.00', '139.0', '103.0', '125.0', '133.0', '138.0', '135.0',
#        '142.0', '77.00', '62.00', '132.0', '84.00', '64.00', '74.00',
#        '116.0', '82.00'], dtype=object)
```

- NaN행 삭제

```python
df.dropna(subset = 'horsepower', axis = 0, inplace = True)
df['horsepower'].unique()
--------------------------------------------------------------------------------
# array(['130.0', '165.0', '150.0', '140.0', '198.0', '220.0', '215.0',
#        '225.0', '190.0', '170.0', '160.0', '95.00', '97.00', '85.00',
#        '88.00', '46.00', '87.00', '90.00', '113.0', '200.0', '210.0',
#        '193.0', '100.0', '105.0', '175.0', '153.0', '180.0', '110.0',
#        '72.00', '86.00', '70.00', '76.00', '65.00', '69.00', '60.00',
#        '80.00', '54.00', '208.0', '155.0', '112.0', '92.00', '145.0',
#        '137.0', '158.0', '167.0', '94.00', '107.0', '230.0', '49.00',
#        '75.00', '91.00', '122.0', '67.00', '83.00', '78.00', '52.00',
#        '61.00', '93.00', '148.0', '129.0', '96.00', '71.00', '98.00',
#        '115.0', '53.00', '81.00', '79.00', '120.0', '152.0', '102.0',
#        '108.0', '68.00', '58.00', '149.0', '89.00', '63.00', '48.00',
#        '66.00', '139.0', '103.0', '125.0', '133.0', '138.0', '135.0',
#        '142.0', '77.00', '62.00', '132.0', '84.00', '64.00', '74.00',
#        '116.0', '82.00'], dtype=object)
```

- 문자열을 숫자로 변환

```python
df['horsepower'] = df['horsepower'].astype(float)
df['horsepower'].dtypes
---------------------------
# dtype('float64')
```

### 숫자 => 범주형

```python
# origin이라는 변수는 1,2,3 숫자 가지고 있음
# 1: 미국, 2: 유럽, 3: 일본
df['origin'].unique()
----------------------
# array([1, 3, 2])

df['origin'].dtypes
----------------------
# dtype('int64')
```

```python
# 숫자를 범주형으로 변환
df['origin'] = df['origin'].astype('category')
df['origin'].dtypes
----------------------------------------------------
# CategoricalDtype(categories=[1, 2, 3], ordered=False)
```

## 구간 분할

1) 선행 연구 등 참고  
2) 데이터 기반 정의 = 예) 히스토그램 설정  

`np.histogram`: 히스토그램 이용해서 구간과 빈도 설정

```python
import numpy as np
count, bins = np.histogram(df['horsepower'], bins = 3)
print(count,bins)
-----------------------------------------
# [257 103  32] [ 46.         107.33333333 168.66666667 230.        ]
```

`pd.cut`: 범주형 변환

```python
bins_name = ['저출력','보통출력','고출력']
df['hp_cat'] = pd.cut(x = df['horsepower'],
                      bins = bins, # 구간의 값
                      labels = bins_name, # 구간 이름
                      include_lowest = True) # 구간의 시작값 포함

print(bins)
print(df['hp_cat'])
-------------------------------------
# [ 46.         107.33333333 168.66666667 230.        ]
# 0      보통출력
# 1      보통출력
# 2      보통출력
# 3      보통출력
# 4      보통출력
#        ... 
# 393     저출력
# 394     저출력
# 395     저출력
# 396     저출력
# 397     저출력
# Name: hp_cat, Length: 392, dtype: category
# Categories (3, object): ['저출력' < '보통출력' < '고출력']
```

## 더미 변수

`pd.get_dummies`

```python
hp_dm = pd.get_dummies(df['hp_cat'])
print(hp_dm)
------------------------------------
#      저출력  보통출력  고출력
# 0      0     1    0
# 1      0     1    0
# 2      0     1    0
# 3      0     1    0
# 4      0     1    0
# ..   ...   ...  ...
# 393    1     0    0
# 394    1     0    0
# 395    1     0    0
# 396    1     0    0
# 397    1     0    0

# [392 rows x 3 columns]
```

`LabelEncoder`: 문자열 범주를 숫자 범주로 변환

```python
# 사이킷런으로 더미변수 만들기
from sklearn import preprocessing
# 전처리 인코더 객체
label_encoder = preprocessing.LabelEncoder()
onehot_encoder = preprocessing.OneHotEncoder()
```

```python
labels = label_encoder.fit_transform(df['hp_cat'])
# 고출력 - 보통출력 - 저출력 (글자 순서대로 정렬)
# 0 - 1 - 2
print(labels)
---------------------------------------------
# [2 2 2 2 2 0 0 0 0 0 0 2 2 0 1 1 1 1 1 1 1 1 1 2 1 0 0 0 0 1 1 1 1 1 1 1 1
#  2 0 2 2 0 0 0 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 0 2 2 2 0 2 2 0 1 2 2 2
#  2 2 1 1 1 1 1 1 1 1 0 2 2 2 2 0 2 2 2 0 0 0 1 1 1 1 1 1 2 2 0 0 1 1 1 1 1
#  1 1 1 2 0 1 1 1 2 2 2 2 0 1 1 1 1 1 1 1 1 2 1 2 2 2 2 2 1 1 1 1 1 1 1 1 1
#  1 1 1 1 1 1 0 2 2 2 2 1 2 1 2 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1
#  2 2 2 2 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 2 1 2 2 0 2 2 2 1 1 1 1 1 2 2 2
#  2 2 1 1 1 0 0 0 2 1 1 1 1 1 1 1 1 1 2 2 1 1 1 1 1 2 2 2 1 1 1 1 1 1 1 1 2
#  2 2 2 2 2 1 1 1 1 1 1 1 1 1 2 2 2 1 1 2 1 1 1 2 2 2 2 2 2 2 2 2 1 1 1 1 1
#  2 1 1 1 1 1 1 1 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1
#  1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 1 1 1 1 1 1 1 1 1 1 1
#  1 1 1 1 1 1 1 1 1 1 2 1 1 2 1 1 1 1 1 1 1 1]
```

```python
# 1차원 배열을 2차원 배열로 전환 => 392개 행과 1개의 열
reshaped = labels.reshape(len(labels),1)
reshaped.shape # (392,1)

# 모든 행 = -1
reshaped = labels.reshape(-1,1)
reshaped.shape # (392,1)
```

`OneHotEncoder`: 원-핫 엔코딩

```python
# 희소행렬 = (행, 열) 좌표 & 값 (1)
# 0 숫자 열 = 고출력, 1 숫자 열 = 보통 출력, 2 숫자 열 = 저출력
# (14,2) 1.0 => 행 인덱스 번호 14, 2라는 숫자(저출력) 가지고 있는 열의 값이 1 => 14번 행의 값은 저출력
oh = onehot_encoder.fit_transform(reshaped)
print(oh)
print(type(oh))
------------------------------------------
#   (0, 1)	1.0
#   (1, 1)	1.0
#   (2, 1)	1.0
#   (3, 1)	1.0
#   (4, 1)	1.0
#   (5, 0)	1.0
#   (6, 0)	1.0
#   (7, 0)	1.0
#   (8, 0)	1.0
#   (9, 0)	1.0
#   (10, 0)	1.0
#   (11, 1)	1.0
#   (12, 1)	1.0
#   (13, 0)	1.0
#   (14, 2)	1.0
#   (15, 2)	1.0
#   (16, 2)	1.0
#   (17, 2)	1.0
#   (18, 2)	1.0
#   (19, 2)	1.0
#   (20, 2)	1.0
#   (21, 2)	1.0
#   (22, 2)	1.0
#   (23, 1)	1.0
#   (24, 2)	1.0
#   :	:

# scipy.sparse._csr.csr_matrix
```

## 정규화

- 최대절대값 정규화  
  - 관측치 / 관측치의 절대값의 최대값  
  - 관측치 = -최대값 => -1, 관측치 = +최대값 => 1  
  - -1 ~  1사이의 값을 가짐  

```python
df['hp_nmz1'] = df['horsepower']/abs(df['horsepower'].max())
df['hp_nmz1'].describe()
--------------------------------
# count    392.000000
# mean       0.454215
# std        0.167353
# min        0.200000
# 25%        0.326087
# 50%        0.406522
# 75%        0.547826
# max        1.000000
# Name: hp_nmz1, dtype: float64
```

- 최소값 - 최대값 정규화
  - (관측치 - 최소값) / (최대값 - 최소값)
  - 관측치 = 최소값 => 0, 관측치 - 최대값 => 1
  - 0 ~ 1 사이의 값을 가짐

```python
df['hp_nmz2'] = (df['horsepower'] - df['horsepower'].min()) / (df['horsepower'].max() - df['horsepower'].min())
df['hp_nmz2'].describe()
--------------------------------
# count    392.000000
# mean       0.317768
# std        0.209191
# min        0.000000
# 25%        0.157609
# 50%        0.258152
# 75%        0.434783
# max        1.000000
# Name: hp_nmz2, dtype: float64
```
